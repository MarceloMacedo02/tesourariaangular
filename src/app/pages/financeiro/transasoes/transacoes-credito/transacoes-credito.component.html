<div class="page-content">
  <div class="container-fluid">
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header align-items-center d-flex">
            <h4 class="card-title mb-0 flex-grow-1">Transações de Crédito</h4>
          </div>
          <div class="card-body">
            <!-- Filtros -->
            <div class="row mb-4">
              <div class="col-md-3">
                <label for="mes" class="form-label">Mês</label>
                <select class="form-select" id="mes" [(ngModel)]="mesFiltro" (ngModelChange)="buscarTransacoes()">
                  <option value="1">Janeiro</option>
                  <option value="2">Fevereiro</option>
                  <option value="3">Março</option>
                  <option value="4">Abril</option>
                  <option value="5">Maio</option>
                  <option value="6">Junho</option>
                  <option value="7">Julho</option>
                  <option value="8">Agosto</option>
                  <option value="9">Setembro</option>
                  <option value="10">Outubro</option>
                  <option value="11">Novembro</option>
                  <option value="12">Dezembro</option>
                </select>
              </div>
              <div class="col-md-3">
                <label for="ano" class="form-label">Ano</label>
                <input type="number" class="form-control" id="ano" [(ngModel)]="anoFiltro" [min]="2020" [max]="2030"
                  (ngModelChange)="buscarTransacoes()">
              </div>
              <div class="col-md-3">
                <label for="tamanhoPagina" class="form-label">Registros por página</label>
                <select class="form-select" id="tamanhoPagina" [(ngModel)]="tamanhoPagina"
                  (ngModelChange)="buscarTransacoes()">
                  <option value="10">10</option>
                  <option value="20">20</option>
                  <option value="30">30</option>
                  <option value="50">50</option>
                </select>
              </div>
            </div>

            <!-- Indicador de carregamento -->
            <div *ngIf="carregando" class="d-flex justify-content-center my-4">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Carregando...</span>
              </div>
            </div>

            <!-- Tabela de transações -->
            <div class="table-responsive" *ngIf="!carregando && transacoes && transacoes.content.length > 0">
              <table class="table table-striped table-hover align-middle">
                <thead class="table-light">
                  <tr>
                    <th>Data</th>
                    <th>Descrição</th>
                    <th>Sócio</th>
                    <th>Categoria</th>
                    <th>Valor</th>
                    <th>Cobranças</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let transacao of transacoes.content">
                    <td>{{ transacao.dataVencimento | date:'dd/MM/yyyy' }}</td>
                    <td>{{ transacao.descricao }}</td>
                    <td>
                      <a href="#" (click)="darBaixa(transacao.id); $event.preventDefault();" class="text-primary text-decoration-underline" style="cursor: pointer;" *ngIf="transacao.socio">
                        {{ transacao.socio.nomeSocio }}
                      </a>
                      <span *ngIf="!transacao.socio">N/A</span>
                    </td>
                    <td>Crédito</td>
                    <td class="text-success">{{ transacao.valor | currency:'BRL' }}</td>
                    <td>
                      <span *ngFor="let cobranca of transacao.listaDeCobrancaMensalidade; let i = index">
                        {{ cobranca.tipoCobranca }}: {{ cobranca.valor | currency:'BRL' }}<span
                          *ngIf="i < (transacao.listaDeCobrancaMensalidade?.length || 0) - 1">, </span>
                      </span>
                    </td>
                    <td>
                      <button class="btn btn-sm btn-outline-primary me-1" (click)="darBaixa(transacao.id)">
                        <i class="fas fa-check"></i> Dar Baixa
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- Mensagem quando não há transações -->
            <div class="alert alert-info text-center"
              *ngIf="!carregando && (!transacoes || transacoes.content.length === 0)">
              Nenhuma transação de crédito encontrada para os filtros selecionados.
            </div>

            <!-- Paginação -->
            <nav aria-label="Navegação de páginas" *ngIf="transacoes && transacoes.totalPages > 1" class="mt-4">
              <ul class="pagination justify-content-center">
                <li class="page-item" [class.disabled]="transacoes.first">
                  <a class="page-link" (click)="mudarPagina(transacoes.number - 1)" [class.disabled]="transacoes.first"
                    [attr.aria-disabled]="transacoes.first">Anterior</a>
                </li>

                <li class="page-item" *ngFor="let pageNumber of getRange(getStartPage(), getEndPage())"
                  [class.active]="pageNumber === transacoes?.number">
                  <a class="page-link" (click)="mudarPagina(pageNumber)">{{ pageNumber + 1 }}</a>
                </li>

                <li class="page-item" [class.disabled]="transacoes.last">
                  <a class="page-link" (click)="mudarPagina(transacoes.number + 1)" [class.disabled]="transacoes.last"
                    [attr.aria-disabled]="transacoes.last">Próxima</a>
                </li>
              </ul>
            </nav>

            <!-- Informações de paginação -->
            <div class="d-flex justify-content-between align-items-center mt-2"
              *ngIf="transacoes && transacoes.totalElements > 0">
              <small class="text-muted">
                Mostrando {{ transacoes.numberOfElements }} de {{ transacoes.totalElements }} transações
              </small>
              <small class="text-muted">
                Página {{ transacoes.number + 1 }} de {{ transacoes.totalPages }}
              </small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>