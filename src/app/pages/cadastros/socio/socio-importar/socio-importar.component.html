<div class="page-content">
  <div class="container-fluid">
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header align-items-center d-flex">
            <h4 class="card-title mb-0 flex-grow-1">Importar Sócios via CSV</h4>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-lg-6">
                <div class="mb-3">
                  <label for="csvFile" class="form-label">Selecionar Arquivo CSV</label>
                  <input 
                    type="file" 
                    class="form-control" 
                    id="csvFile"
                    accept=".csv"
                    (change)="onFileSelected($event)"
                    [disabled]="loading">
                  <div class="form-text">Formato aceito: CSV. Apenas arquivos CSV são permitidos.</div>
                </div>
                
                <div class="d-flex gap-2">
                  <button 
                    type="button" 
                    class="btn btn-primary" 
                    (click)="uploadCSV()"
                    [disabled]="!selectedFile || loading">
                    <span *ngIf="loading" class="spinner-border spinner-border-sm me-2" role="status"></span>
                    {{ loading ? 'Processando...' : 'Importar CSV' }}
                  </button>
                  
                  <button 
                    type="button" 
                    class="btn btn-success" 
                    (click)="exportResults()"
                    [disabled]="!results || loading">
                    Exportar JSON
                  </button>
                  
                  <button 
                    type="button" 
                    class="btn btn-danger" 
                    (click)="exportResultsToPDF()"
                    [disabled]="!results || loading">
                    Exportar PDF
                  </button>
                </div>
              </div>
              
              <div class="col-lg-6">
                <div class="alert alert-info">
                  <h5 class="alert-heading">Instruções:</h5>
                  <ul class="mb-0">
                    <li>O arquivo deve estar no formato CSV</li>
                    <li>As colunas devem estar na ordem correta</li>
                    <li>As colunas obrigatórias são: nomeSocio, cpf</li>
                    <li>O sistema validará os dados antes de importar</li>
                  </ul>
                </div>
              </div>
            </div>
            
            <!-- Indicador de carregamento -->
            <div *ngIf="loading" class="mt-4">
              <div class="d-flex align-items-center">
                <div class="spinner-border text-primary me-2" role="status"></div>
                <span>Processando o arquivo CSV, por favor aguarde...</span>
              </div>
            </div>
            
            <!-- Mensagens de erro -->
            <div *ngIf="error" class="alert alert-danger mt-3">
              {{ error }}
            </div>
            
            <!-- Resultados do processamento -->
            <div *ngIf="results" class="mt-4">
              <h5>Resultados do Processamento</h5>
              <div class="row mb-3">
                <div class="col-md-4">
                  <div class="card text-center">
                    <div class="card-body">
                      <h5 class="card-title">{{ results.linhasProcessadas || 0 }}</h5>
                      <p class="card-text">Linhas Processadas</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="card text-center">
                    <div class="card-body">
                      <h5 class="card-title">{{ getNovosSociosCount() || 0 }}</h5>
                      <p class="card-text">Sócios Novos</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="card text-center">
                    <div class="card-body">
                      <h5 class="card-title">{{ getAtualizadosSociosCount() || 0 }}</h5>
                      <p class="card-text">Sócios Atualizados</p>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Lista de sócios processados -->
              <div class="table-responsive">
                <table class="table table-striped table-nowrap align-middle mb-0">
                  <thead class="table-light">
                    <tr>
                      <th>Nome</th>
                      <th>CPF</th>
                      <th>Status</th>
                      <th>Tipo</th>
                      <th>Mensagem</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let socio of results.sociosProcessados">
                      <td>{{ socio.nomeSocio }}</td>
                      <td>{{ socio.cpf }}</td>
                      <td>
                        <span class="badge" [ngClass]="getStatusBadgeClass(socio.status)">
                          {{ socio.status }}
                        </span>
                      </td>
                      <td>
                        <span class="badge" [ngClass]="getTipoBadgeClass(socio)">
                          {{ socio.novo ? 'Novo' : socio.atualizado ? 'Atualizado' : 'Sem alteração' }}
                        </span>
                      </td>
                      <td>{{ socio.mensagem }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>